#!/bin/bash

# exit on the first error
set -e

BCFILE=${1%.*}.bc
OBJFILE=${1%.*}.o

qs $1 -m
llvm-link ${QS_LIB_PATH}/stdlib.bc ${BCFILE} ${@:2} |\
  opt -O3 -std-compile-opts |\
  llc -filetype=obj -o  ${OBJFILE}
gcc ${OBJFILE} `pkg-config libqs --libs` -lstdc++ -lm -o ${1%.*}
